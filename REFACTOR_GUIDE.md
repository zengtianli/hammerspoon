# 项目重构通用指南

## 🎯 重构目标

### 核心原则
- **功能聚合**：将相关功能集中管理，避免配置分散
- **结构扁平化**：简化目录结构，减少不必要的嵌套
- **零功能损失**：确保重构后所有原有功能保持不变
- **性能优化**：减少不必要的资源消耗，提升运行效率
- **维护简化**：降低配置和代码的复杂度，便于后续维护

### 量化指标
- **文件数量减少**：目标减少 70-80% 的冗余文件
- **功能完整性**：100% 功能保持
- **性能提升**：优化启动或运行时间
- **可维护性提升**：配置和代码修改更加便捷

## 📋 重构步骤

### 1. 现状分析
- 统计现有文件数量和结构
- 梳理各功能模块的分布和依赖

### 2. 功能分类归并
- 按功能对配置或代码进行归类
- 合并分散的配置文件或模块
- 统一管理插件、依赖、工具等
- 保留必要的特殊配置

### 3. 文件清理
- 删除冗余、重复或已合并的文件
- 清理无用目录和资源

### 4. 引用与依赖更新
- 检查并更新所有引用路径
- 验证依赖关系的正确性
- 确保自定义功能正常加载

## 🏗️ 已实现架构

### 重构后的项目结构
```
hammerspoon/
├── init.lua                  # 主入口文件
├── config/                   # 配置管理
│   ├── settings.lua          # 用户设置
│   └── hotkeys.lua           # 快捷键配置
├── modules/                  # 功能模块
│   ├── core/                 # 核心功能
│   │   ├── utils.lua         # 通用工具库
│   │   ├── script.lua        # 脚本执行
│   │   └── hotkeys.lua       # 热键管理
│   ├── apps/                 # 应用控制
│   │   ├── manager.lua       # 应用管理器
│   │   ├── restart.lua       # 应用重启
│   │   └── wechat.lua        # 微信启动器
│   ├── tools/                # 工具集
│   │   ├── clipboard.lua     # 剪贴板工具
│   │   ├── compress.lua      # 文件压缩
│   │   └── system.lua        # 系统工具
│   │   └── test.lua          # 测试工具
│   ├── media/                # 媒体控制
│   │   └── music.lua         # 音乐控制
│   └── macro/                # 宏系统
│       ├── recorder.lua      # 宏录制
│       ├── player.lua        # 宏播放
│       └── hotkeys.lua       # 宏快捷键
├── scripts/                  # 脚本目录
│   ├── apps/                 # 应用相关脚本
│   ├── tools/                # 工具脚本
│   ├── media/                # 媒体脚本
│   └── macro/                # 宏脚本
└── macros/                   # 宏文件存储
```

### 核心统一文件说明

#### `config/settings.lua`
- 统一管理所有用户配置项
- 定义偏好终端、IDE等选项
- 设置关键目录路径

#### `config/hotkeys.lua`
- 集中管理所有快捷键定义
- 按功能模块分组组织
- 支持动态绑定回调函数

#### `modules/core/utils.lua`
- 提供所有模块共用的工具函数
- 支持脚本执行、文件操作、通知提示等
- 定义标准模块创建方法

## ✅ 验证标准

### 功能验证
- [x] 所有核心功能正常运行
- [x] 依赖/插件/第三方库正常加载
- [x] 关键配置项生效
- [x] 自定义功能无异常

### 性能验证
- [x] 启动或运行时间优化
- [x] 资源消耗合理

### 结构验证
- [x] 文件数量和结构符合预期
- [x] 目录层级清晰，逻辑明确

## 🚀 重构成果
1. **扁平化目录结构**：从嵌套多层到逻辑清晰的分组
2. **模块化组织**：按功能归类所有代码
3. **集中化配置**：将散布的配置集中在config目录
4. **简化依赖关系**：通过模块加载器管理依赖
5. **有序脚本组织**：按功能分类所有脚本文件
6. **完善的文档**：更新所有文档反映新架构

---

重构已完成！本项目已经从原始结构成功转变为更加模块化、可维护的架构。 